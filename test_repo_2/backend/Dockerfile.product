# USING FULL NODE IMAGE - LARGE SIZE
FROM node:16
# Should use: FROM node:16-alpine

# WORKING DIRECTORY
WORKDIR /app

# COPY PACKAGE FILES - GOOD PRACTICE
COPY package*.json ./

# INSTALL DEPENDENCIES - MISSING PRODUCTION FLAG
RUN npm install
# Should use: npm ci --only=production

# COPY SOURCE CODE
COPY . .

# MISSING SECURITY UPDATES
# RUN apk update && apk upgrade

# CREATE NON-ROOT USER - GOOD PRACTICE
RUN addgroup -g 1001 -S nodejs
RUN adduser -S nextjs -u 1001

# CHANGE OWNERSHIP
RUN chown -R nextjs:nodejs /app
USER nextjs

# EXPOSE PORT
EXPOSE 3002

# MISSING HEALTH CHECK

# START APPLICATION - DEVELOPMENT MODE
CMD ["node", "product_service.js"]
# Should use production process manager like PM2
